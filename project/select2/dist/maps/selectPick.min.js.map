{"version":3,"sources":["selectPick.js"],"names":["$","w","document","undefined","resizeWindow","self","setPosition","activeList","ele","addClass","addName","siblings","removeClass","text","data","nowNode","id","node","mask","hide","listHide","show","window","off","container","key","value","listLength","defaults","search","listHeight","placeholder","_classCallCheck","this","selectPick","callback","extend","opt","noData","searchLength","change","tabIndex","_createClass","o","child","select","getElementById","renderHTML","drop","append","input","find","attr","arguments","length","html","item","m","i","indexOf","searchFlag","items","val","lists","l","scrollTop","eq","currentOffset","offset","top","outerHeight","activeBottom","$active","activeOffset","currentLeft","left","css","currentTop","width","currentWidth","_this","$input","on","e","ev","event","renderList","gotoActive","bind","stopPropagation","cancelBubble","bindKeyDown","outerWidth","$that","_this2","flag","_this3","nextTop","nextOffset","$next","bindItem","nextBottom","keyCode","getValue","back","trim","jQuery"],"mappings":"8XAWC,SAAUA,EAAGC,EAAGC,EAASC,GAEzB,IAAMC,EAAa,SAACC,GACnBA,EAAKC,eAHLC,EAAeL,SAAAA,EAAAA,EAASC,GACzBK,EAAAC,SAAAC,GAAAC,WAAAC,YAAAF,GACAL,EAAMD,KAAAA,SACLC,GAAAA,EAAKC,KAAAA,MADNO,KAAAL,EAAAK,SAMMC,EAAKC,SAAAA,GACTC,EAAGR,KAAIM,MAAK,EACZD,EAAAA,KAAKL,OAFYS,EAAlBC,KAAAC,OAMDF,EAAMG,MAAAA,IAAS,oBACdf,EAAKS,KAAKO,IAAV,SAEAJ,EAAAA,QAAUE,IAAV,SAAAf,EAAAC,IAOAL,EAAEsB,QAAQC,IAAI,SAASlB,EAAKC,gBAHvBY,GAOLM,UAAU,OALVxB,QAAEsB,EACFtB,QAVDyB,IAAA,KAYAC,MAAA,GACAC,WAAMC,EACLJ,WAAU,GACVK,YAAO,MACPf,SAHc,KAIdW,OAAI,QAEJE,KACAG,EAlCkC,WAmClCC,SAAAA,EAAAA,GAAYC,gBAAAC,KAAAC,GACZC,KAAAA,EAAAA,EAASC,QATK,KAAAR,EAAAS,OAUdC,KAAAA,MAVDX,WAAA,EAYAY,aAAY,EAOTlB,MAAK,EA9C2BmB,QAwC7BN,EACLO,SAAA,EAAgB1B,SASbC,IAAI,EARNH,KAAA,KAGC0B,KAAAA,SA7CgC,OAAAG,aAAAR,IAAAT,IAAA,OAAAC,MAAA,WAgDhCe,KAAAA,aACA1B,KAAAA,OACCC,KADO2B,EAAAd,QAEPhB,KAAAA,YAnD+BY,IAAA,aAAAC,MAAA,WAuDjCO,KAAAW,MAAAC,OAAA7C,EAAAA,6DAAAiC,KAAAU,EAAAZ,YAAA,YAAAE,KAAAU,EAAAjB,MAAA,YAvDiC,IAAAR,EAAAhB,EAAA4C,eAAA,cAAA5B,EA2DjCD,EAAGC,KAAAlB,EAAO6B,IA3DuBZ,EAAAC,KAAAlB,EAAA,+BAyDjCA,EAAA,QAAK+C,OAAL9B,EAAAC,OAIC,IAAA8B,EAAA9C,EAAA4C,eAAA,cACDE,EACc/B,EAAA+B,KAAAhD,EAAAgD,IA/DmB/B,EAAA+B,KAAAhD,EAAAA,0CAAAiC,KAAAU,EAAAhB,WAAAM,KAAAU,EAAAb,WAAA,uBAAA9B,EAAA,QAAAiD,OAAAhC,EAAA+B,OAkEjChD,EAAAiC,KAAMf,EAAAA,WAAKhB,KAAS4C,KAAAA,MAAeD,QACnCZ,KAAGW,MAAHM,MAASjB,KAAAW,MAAAC,OAAAM,KAAA,SACRlC,EAAAA,MAAAA,EAAY+B,KAAAG,KAAA,MACVlB,KAAAU,EAAFd,SACAI,KAHDW,MAGKM,MAAAE,KAAA,WAAA,YACJnC,KAAAA,MAAA4B,OAAY3B,OAAZD,yCAvEgCQ,IAAA,aAAAC,MAAA,WA0EtB,IAALsB,EAAKK,UAAAC,OAAA,QA1Eb,IA0EaD,UAAA,GAAAA,UAAA,GAAAnD,GAAAA,EAAAmD,UAAAC,OAAA,QA1Eb,IA0EaD,UAAA,IAAAA,UAAA,GACXE,EAAIP,GAAKQ,EAAA,GAAAC,EAAAxB,KAAAnB,KAAAC,QAAAC,IAAA,EAAAiB,KAAAnB,KAAAC,QAAAC,GAAA,EAGR,GAFAC,KAAAA,KAAK+B,aAAKhD,EACVA,KAAEc,KAAFa,WAAiBV,KAAK+B,EAAtBlC,KAAAwC,OAFDrB,KAGKnB,KAAAa,YAAA,GAAA,KAAAM,KAAAU,EAAA7B,KAAA,GAAA,OAAA,EACJG,IAAAA,IAAK+B,EAAAA,EAALU,EAAU1D,KAAEgD,KAAZrB,WAAA+B,IACAF,EAAAvB,KAAAU,EAAAlB,IAAAQ,KAAAU,EAAA7B,KAAA4C,GAAAzB,KAAAU,EAAAlB,KAAAQ,KAAAU,EAAA7B,KAAA4C,GAiBGzB,KAAKU,EAAEd,QAAU2B,EAAKG,QAAQ9C,GAAM,GAAa,IAARA,GAAc+C,IAflDpC,IAAPX,GAAOW,KAAW+B,KAAKxC,QAAAC,GAAW6B,EACpCW,IAAWN,GACXjC,GAAAA,gBAAqBkC,EAArBlC,oBAAAuC,EAAAvC,QACAgB,KAAInB,KAAOe,SAAUb,GAAA0C,EACpB7C,KAAK+B,GAELX,KAAAnB,KAAA2B,SAAAiB,GAxFgCH,GAAAA,gBAAAG,EAAA,KAAAF,EAAA,QA0FED,GAAAA,gBAAAG,EAAA,MAAAD,IAAAC,EAAA,iBAAA,IAAA,IAAAF,EAAA,UAAGvB,KAAAnB,KAAAyB,cACtC,QAAAN,KAAYuB,EAAAA,QAAZ,KAAAD,KAAAtC,EAAoBwC,MAAEF,KAAKzC,GAC3BG,EAAA4C,MAAUtB,EAAAA,MAAAA,KAAV,OACKzB,MA7F4BW,IAAA,UAAAC,MAAA,WA+FjC,IAAIZ,EAAJuC,UAAAC,OAAA,QA/FF,IA+FED,UAAA,GAAAA,UAAA,MAgBE,OAfDG,KAAAA,EAAAA,KAAK1C,EACF,KAAHmB,KAAGU,EAAAjB,MACHO,KAAGpB,MAAAA,MAAAiD,IAAc,IAChB7B,KAAAW,MAAGY,MAAO3C,IAAKoB,KAAAU,EAAAjB,OAEdO,KAAAnB,MACCE,MAAAA,EACAH,SAFiBG,IAAlB,EAIAH,KAAA,KAGAoB,KAAAnB,KAAAO,MAAA,EACDJ,EAXD+B,KAWK7B,OACJoC,EAAAA,KAAAA,OACAtB,QA/G+BR,IAAA,WAAAC,MAAA,WAkHjC,OACAT,KAAK8C,KAALjD,KAAAC,QAAAC,GAAA,GAAA,EAAAiB,KAAAU,EAAA7B,KAAAmB,KAAAnB,KAAAC,QAAAC,IACAC,MAAK4C,KAAL/C,KAAWG,QAAWkC,SApHW1B,IAAA,gBAAAC,MAAA,WAAA,IAAAoC,EAAAT,UAAAC,OAAA,QAAnC,IAAmCD,UAAA,GAAAA,UAAA,GAAA,GAAApB,KAAAU,EAAAjB,MAAAoC,EAAA7B,KAAAW,MAAAM,MAAAY,IAAAA,GAuHd,IAAA,IAAJN,EAAA,GAAIE,EAAA,EAAAM,EAAA/B,KAAAU,EAAA7B,KAAAwC,OAAAI,EAAAM,EAAAN,IAEnB,IADAF,EAAKb,KAAE7B,EAAPW,IAAYX,KAAZ6B,EAAA7B,KAAA4C,GAAAzB,KAAAU,EAAAlB,KAAAQ,KAAAU,EAAA7B,KAAA4C,MACGI,EAKH,OAJC7B,KAAKW,KAAL7B,SADDC,GAAA0C,EAGC7C,KAAK+B,IAED9B,KA9H4BW,IAAA,aAAAC,MAAA,WAgIxB,IAAA,IAAAO,KAAAnB,KAAAC,QAAAC,GAKT,OAPUC,EAAV+B,KAAAiB,UAAA,IAOKnD,EAELG,IAAKC,EAAKC,EAAV0C,MAAAK,GAAAjC,KAAAnB,KAAAC,QAAAC,IACAmD,EAAAlD,EAAA+B,KAAAoB,SAAAC,IAAApD,EAAA+B,KAAAsB,aAAA,GACAC,EAAAC,EAAAJ,SAAAC,IAAAG,EAAAF,aAAA,GAzIiCG,EAAAxD,EAAA+B,KAAAiB,YAAAM,EAAAJ,EAAAlD,EAAA+B,KAAAiB,UAAAQ,MAAAhD,IAAA,cAAAC,MAAA,WA2IjC,IAAAyC,EAAOlC,KAAAW,MAAAC,OAAAuB,SACNtD,EAAKqD,EAAqBE,IAAEpC,KAAGW,MAAAC,OAAYyB,aAAUvD,GACrDW,EAAgBX,KAAAA,MAAQF,OAAAA,aAFzB6D,EAAAP,EAAAQ,KAIA1D,EAAA+B,KAAA4B,KA/IiCD,KAAAD,EAAAL,IAAAQ,EAAAC,MAAAC,EAAA,OAAAtD,IAAA,OAAAC,MAAA,WAiJjC,IAAAsD,EAAA/C,KAEIuB,EACJwB,EAAQtB,EAAAA,OAGD5C,EAAKC,MAAVmC,MAFI8B,EAAKrC,MAALE,OAAgBF,KAAE7B,kBAEJmE,EAAlBC,GAAA,QAAA,SAAAC,GAIA,IAAAC,EAAO9D,OAAP+D,OAAAF,EACAH,EAAAM,WAAAN,EAAArC,EAAAjB,QAEFT,EAAA8C,MAAAR,KAAA,4BAAAyB,EAAArC,EAAAL,OAAA,SA9JiC0C,EAAA1E,cAAAW,EAAAC,KAAAG,OA+JlBJ,EAAA+B,KAAA3B,OACf2D,EAAGO,aAA+BP,EAAAlE,KAAAO,MAAA,EACjCJ,EAAAA,KAAAwB,SAAUwB,EAAVnD,KAAAC,QAAAC,GAAA,EAAA,EAAAgE,EAAAlE,KAAAC,QAAAC,GAGDgE,EAAMR,SAAQvD,GAAd+D,EACGb,WADHnE,EAAAsB,QAGGmD,GAAAA,SAAexD,EAAAA,IAClBA,EAAAA,QAAUgD,GAAAA,SAAUQ,EAAAA,YAApBe,KAAoBf,IACpBW,EAAAK,gBAAAL,EAAAK,kBAAAL,EAAAM,cAAA,IAzKiCzD,KAAA0D,YAAAV,MAAAxD,IAAA,WAAAC,MAAA,WA2KjC,IAAMyC,EAAAA,KAANlD,EACM4D,MAAAA,GAAAA,aAAWV,KAAcE,WAD/BrE,EAAAiC,MAEM8C,SAAAA,UAAkBnC,WAAagD,YAFrC,UAAAvF,EAGMqE,KAAAA,SAAYP,EAAAA,MAAAA,KAAcQ,QAE/BA,EAAAA,MAAKD,GAAAA,QADQ,KAAA,SAAAS,GAEbd,IAAAA,EAAIQ,OAAAA,OAFSM,EAGbL,EAAMC,EAAAA,MAHO,GAAdc,EAAA/E,KAAA,YAAA,OAAA,EAKAP,EAAAsF,EAAA,SAAAxF,GApLiCA,EAAAuC,MAAAM,MAAAY,IAAAzD,EAAAS,KAAAC,QAAAF,MAAAO,EAAAf,GAAA+E,EAAAK,gBAAAL,EAqL5BK,kBAAAL,EAAAM,cAAA,OArL4BjE,IAAA,WAAAC,MAAA,SAqLzBuD,GAAA,IAAAa,EAAA7D,KACRhB,EAAMZ,KAAAA,GAAK,QAAX,WACAyF,EAAMb,KAAQ5D,OAAQ,KAAAyE,EAAAhF,KAAAC,QAAAF,KACrBoE,EAAInB,IAAAgC,EAAOjE,KAAOd,QAAAF,MAAlBoE,EAEKnB,IAAAgC,EAAAnD,EAAAjB,OAEJN,EAAAA,SA5L+BK,IAAA,cAAAC,MAAA,SA+LvBJ,GAAO+D,IAAAA,EAAAA,KACVU,EAAAA,KACN9D,KAAAW,MAAAC,OAASqC,GAAA,UAAA,SAAAC,GAAG,IAAAC,EAAA9D,OAAA+D,OAAAF,EACXlE,GAAWsC,IAAXtC,EAAAA,QAAA,CACA,GAAA+E,EAAAlF,KAAA2B,UAAA,EAAA,OAAA,IACDuD,EAAK1F,KAAAA,SACLW,IAAKC,EAALD,EAAA+B,KAAAoB,SAAAC,IACApD,EAAAA,EAAA4C,MAAAK,GAAA8B,EAAAlF,KAAA2B,UACAwD,EAAKV,EAALnB,SAAAC,IACA6B,EAAAjF,EAAe+B,KAAfiB,aAAAgC,EAAA9B,GAKA,OAJAgC,EAAKrF,SAAK2B,UAAS9B,WAAUI,YAAV,UAoDfkF,EAAU9B,EAAgB,GAlD9BlD,EAAA+B,KAAAiB,UAAAiC,IAEKE,EAELpG,GAAa,IAAXsB,EAAAA,QAAW,CACbtB,GAAEsB,EAAFR,KAAa2B,UAASuD,EAAAlF,KAAKR,aAAL,EAAA,OAAtB,IACA8E,EAAGK,KAAAA,SAnBJ,IAAAU,EAAAlF,EAAA4C,MAAAK,GAAA8B,EAAAlF,KAAA2B,UAqBA0B,EAAiBc,EAAjBjC,KAAAoB,SAAAC,IAAApD,EAAA+B,KAAAsB,aAAA,GACA+B,EAAAF,EAAA/B,SAAAC,IAAA8B,EAAA7B,aAAA,GApNiC4B,EAAAjF,EAAA+B,KAAAiB,YAAAoC,EAAAlC,EAuNjClD,OAvNiCkF,EAAA1F,SAAA,UAAAE,WAAAC,YAAA,UAAAyF,EAAAlC,GAqNpBlD,EAAA+B,KAAAiB,UAAAiC,IAERnC,EACJ/D,GAAQS,IAAN2E,EAAAkB,QAAe,CACjBjG,IAAAA,EAAUoC,EAAAA,MAAWyB,GAAA7D,EAAMS,KAAK2B,UAFjC,GAAA1B,EAAAD,KAAA,YAAA,OAAA,EAIAG,EAAAZ,GAA0CE,EAAAQ,EAAA,SAAAV,GACzC2F,EAAIZ,MAAG9D,MAAO+D,IAAPhF,EAAPS,KAAAC,QAAAF,MACA,IAAMgF,EAAAA,EAAQU,WACdlG,EAAGwF,EAAAA,UAAWxF,EAAAsC,EAAdR,SAAkCqE,EAAP1F,KAAe0F,EAAA9E,OAC1CnB,EAAAA,aA/NgCkB,IAAA,SAAAC,MAAA,WAoOjC,IAAArB,EAAA4B,KApOiCA,KAAAW,MAAAM,MAAAgC,GAAA,uBAAA,WAAA,GAAA7E,EAAAS,KAAAa,YAAA,EAqOlB,OArOkBV,EAAA8C,MAAAR,KAAA,4BAqOlBtB,KAAAU,EAAAL,OArOkB,UAqOlB,EAAI,IAAAwB,EAAA9D,EAAAyG,KAAAxE,KAAAP,OACU,IAAnBwD,EAAGI,WAAQxB,GAAA,GAEnB,OADD7C,EAAG8C,MAAKjD,KAAR,gCAAkBgD,EAAlB,WACI,EACKA,KAAPmB,GACA5E,EAFDS,KAEK2B,SAAApC,EAAAS,KAAAC,QAAAC,GACJiE,EAAAA,eAED7D,EAAAA,KAAAA,SAAAA,EACAH,EAAA4C,MAAAK,GAAA,GAAAzD,SAAA,UAAAE,WAAAC,YAAA,iBA9O+BsB,EAAA,GAiPfjC,EAAAiC,WAAAA,EAjPpB,CAoTEwE,OAAQpF,OAAQpB","file":"../js/selectPick.min.js","sourcesContent":["/*\r\ncontainer:盛放select得dom\r\nsearch:是否启用模糊搜索\r\ndata:存放数据\r\nkey:有这个说明数组里面是object格式得\r\nlistLength:一屏显示几个list\r\nlistHeight:每个list的高度\r\nplaceholder:提示\r\nvalue:输入框初始值\r\nnoData:没有数据时得显示\r\n*/\r\n;(function($, w, document,undefined){\r\n\t//页面大小改变时时更改下拉框得大小和为止\r\n\tconst resizeWindow=(self)=>{\t\t\t\r\n\t\tself.setPosition()\r\n\t}\t\r\n\t//设置选中项\r\n\tconst activeList=(ele,addName,self)=>{\r\n\t\tele.addClass(addName).siblings().removeClass(addName)\r\n\t\tself.data.nowNode={\t\t\t//记录选中的项的数据\r\n\t\t\tid:ele.data(\"id\"),\r\n\t\t\ttext:ele.text()\r\n\t\t}\r\n\t}\t\r\n\t//隐藏下拉框\r\n\tconst listHide=(self)=>{\t\t\t\r\n\t\tself.data.show=false;\t\t\r\n\t\tnode.drop.hide();\t\r\n\t\tnode.mask.hide()\r\n\r\n\t\t//防止混乱和多次绑定事件，每次隐藏下拉时，都注销公用部分事件\r\n\t\tnode.lists.off(\"click mouseenter\")\t\t\r\n\t\tnode.mask.off(\"click\")\r\n\r\n\t\t$(window).off(\"resize\",resizeWindow(self))\t\r\n\t\t$(window).off(\"scroll\",self.setPosition())\r\n\t}\r\n\t/*默认值*/\r\n\tconst defaults={\r\n\t\tcontainer:\"body\",\r\n\t\tsearch:false,\r\n\t\tdata:[],\r\n\t\tkey:null,\r\n\t\tvalue:\"\",\r\n\t\tlistLength:4,\r\n\t\tlistHeight:32,\r\n\t\tplaceholder:\"请输入\",\r\n\t\tcallback:null,\r\n\t\tnoData:\"没有数据\"\t\t\r\n\t}\r\n\tlet node={} //存放插件得dom\t\t\r\n\tclass selectPick{\r\n\t\tconstructor(opt){\r\n\t\t\tthis.o=$.extend(true,{},defaults, opt||{})\r\n\t\t\tthis.data={  //存放插件里面得状态和数据\r\n\t\t\t\tlistLength:0,\t\t//是否有数据\r\n\t\t\t\tsearchLength:0,\t\t//搜索结果的个数\r\n\t\t\t\tshow:false,   //当前下拉是否已经显示\r\n\t\t\t\tchange:false,  //当前数据是否更改过\r\n\t\t\t\ttabIndex:0,  //用来记录按上下键时的id即焦点在第几个li上\r\n\t\t\t\tnowNode:{\t\t//存放已经选中得项\r\n\t\t\t\t\tid:-1,\r\n\t\t\t\t\ttext:\"\"\r\n\t\t\t\t}\r\n\t\t\t}\t\r\n\t\t\tthis.child={}  //存放container下得元素\r\n\t\t}\r\n\t\tinit(){\r\n\t\t\tthis.renderHTML()\r\n\t\t\tthis.bind()\r\n\t\t\tif(this.o.search){\t\t//是否有模糊搜索功能\r\n\t\t\t\tthis.search()\r\n\t\t\t}\r\n\t\t}\r\n\t\trenderHTML(){\t\t//渲染页面\r\n\t\t\tthis.child.select=$(` <div class=\"selectPick\" ><input type=\"text\" placeholder=\"${this.o.placeholder}\" value=\"${this.o.value}\"></div>`);\r\n\t\t\t//公共背景\r\n\t\t\tconst mask=document.getElementById(\"selectMask\");\r\n\t\t\tif(!mask){ \r\n\t\t\t\tnode.mask=$(\"<div id='selectMask'></div>\")\r\n\t\t\t\t$(\"body\").append(node.mask)\r\n\t\t\t}else{\r\n\t\t\t\tnode.mask=$(mask)\r\n\t\t\t}\r\n\t\t\t//公共列表\r\n\t\t\tconst drop=document.getElementById(\"selectDrop\");\r\n\t\t\tif(!drop){\t\t\r\n\t\t\t\tnode.drop=$(`<div id=\"selectDrop\" style=\"max-height:${this.o.listLength*this.o.listHeight}px\"><ul></ul></div>`)\r\n\t\t\t\t$(\"body\").append(node.drop)\r\n\t\t\t}else{\r\n\t\t\t\tnode.drop=$(drop)\r\n\t\t\t}\r\n\r\n\t\t\t$(this.o.container).html(this.child.select);\r\n\t\t\tthis.child.input=this.child.select.find(\"input\");\r\n\t\t\tnode.lists=node.drop.find(\"ul\");\r\n\t\t\tif(!this.o.search){\t\t//如果没有模糊搜索，则禁用输入框\r\n\t\t\t\tthis.child.input.attr(\"disabled\",\"disabled\")\r\n\t\t\t\tthis.child.select.append(`<div class=\"inputDisabled\"></div>`)\r\n\t\t\t}\t\t\r\n\t\t}\r\n\t\trenderList(text=\"\",searchFlag=false){\t\t//渲染list;text：默认选择和此值匹配得项，searchFlag:区分当前是否是在模糊搜索\r\n\t\t\tlet html=\"\",item=\"\",m=this.data.nowNode.id>=0?this.data.nowNode.id:0;\r\n\t\t\tthis.data.searchLength=0\r\n\t\t\tthis.data.listLength=this.o.data.length\r\n\t\t\tif(this.data.listLength<=0 || this.o.data[0]===\"\") return false;\t\t\t//没有数据\r\n\t\t\tfor(let i=0;i<this.data.listLength;i++){\r\n\t\t\t\titem=this.o.key?this.o.data[i][this.o.key]:this.o.data[i]\r\n\t\t\t\tif(this.o.search && item.indexOf(text)<0 && text != \"\" && searchFlag) continue;\t\t//如果有模糊搜索并且没有匹配到则退出当前循环\r\n\t\t\t\tif(text != \"\" && this.data.nowNode.id<0){\t//如果有初始值,则默认选中初始值\t\r\n\t\t\t\t\tif(item===text){\r\n\t\t\t\t\t\thtml+=`<li data-id=\"${i}\" class=\"active\">${item}</li>`;\r\n\t\t\t\t\t\tthis.data.nowNode={\r\n\t\t\t\t\t\t\tid:i,\r\n\t\t\t\t\t\t\ttext:item\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.data.tabIndex=i\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\thtml+=`<li data-id=\"${i}\">${item}</li>`\r\n\t\t\t\t\t}\t\t\t\t\r\n\t\t\t\t}else{\r\n\t\t\t\t\thtml+=`<li data-id=\"${i}\" ${m===i?`class=\"active\"`:\"\"}>${item}</li>`\r\n\t\t\t\t}\t\t\t\r\n\t\t\t\t++this.data.searchLength\r\n\t\t\t}\r\n\t\t\tif(this.o.search && html===\"\") return false;  //搜索时没有匹配到\r\n\t\t\tnode.lists.html(html)\r\n\t\t\tnode.items=node.lists.find(\"li\");\t\t//选择已经渲染到页面得数据node\r\n\t\t\treturn true\r\n\t\t}\r\n\t\tsetData(data=[]){\t\t\t//设置下拉列表得数据\r\n\t\t\tthis.o.data=data;\r\n\t\t\tif(this.o.value === \"\"){\r\n\t\t\t\tthis.child.input.val(\"\");\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\tthis.child.input.val(this.o.value)\r\n\t\t\t}\r\n\t\t\tthis.data={\r\n\t\t\t\tshow:false,\r\n\t\t\t\tnowNode:{\r\n\t\t\t\t\tid:-1,\r\n\t\t\t\t\ttext:\"\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.data.show=false;\r\n\t\t\tnode.drop.hide();\t\r\n\t\t\tnode.mask.hide()\r\n\t\t\treturn this\r\n\t\t}\r\n\t\tgetValue(){\t\t\t//获取已经选中得项得数据\r\n\t\t\treturn {\r\n\t\t\t\tdata:this.data.nowNode.id<0?-1:this.o.data[this.data.nowNode.id],\r\n\t\t\t\tvalue:this.data.nowNode.text\r\n\t\t\t}\t\t\t\t\r\n\t\t}\r\n\t\tsetDefaultVal(val=\"\"){\t\t//设置默认值，为异步设置默认值用得\r\n\t\t\tthis.o.value=val\r\n\t\t\tthis.child.input.val(val)\r\n\t\t\tlet item=\"\";\r\n\t\t\tfor(let i=0,l=this.o.data.length;i<l;i++){\r\n\t\t\t\titem=this.o.key?this.o.data[i][this.o.key]:this.o.data[i];\r\n\t\t\t\tif(item===val){\t\t\t\t\t\r\n\t\t\t\t\tthis.data.nowNode={\r\n\t\t\t\t\t\tid:i,\r\n\t\t\t\t\t\ttext:item\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tgotoActive(){\t\t\t//设置已经选中项在页面可视区域\r\n\t\t\tif(this.data.nowNode.id === -1){\t\t//如果没有选中项，\r\n\t\t\t\tnode.drop.scrollTop(0)\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\tconst $active=node.items.eq(this.data.nowNode.id),\r\n\t\t\t\t  currentOffset=node.drop.offset().top + node.drop.outerHeight(false),\r\n\t\t\t\t  activeBottom = $active.offset().top + $active.outerHeight(false),\r\n\t\t\t\t  activeOffset = node.drop.scrollTop() + activeBottom - currentOffset;\r\n\t\t\tnode.drop.scrollTop(activeOffset)\r\n\t\t}\r\n\t\tsetPosition(){\t\t//设置下拉框得位置和大小\r\n\t\t\tconst currentOffset=this.child.select.offset(),\r\n\t\t\t      currentTop=currentOffset.top+this.child.select.outerHeight(false),\r\n\t\t\t      currentWidth=this.child.select.outerWidth(),\r\n\t\t\t      currentLeft=currentOffset.left;\r\n\t\t\tnode.drop.css({\r\n\t\t\t\tleft:currentLeft,\r\n\t\t\t\ttop:currentTop,\r\n\t\t\t\twidth:currentWidth-2\r\n\t\t\t})\r\n\t\t}\r\n\t\tbind(){\t\t//绑定事件\r\n\t\t\tconst self=this;\r\n\t\t\tconst $input=(()=>{\t\t\t//选择接受点击事件得元素\r\n\t\t\t\tif(!this.o.search){\r\n\t\t\t\t\treturn this.child.select.find(\".inputDisabled\")\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn this.child.input\r\n\t\t\t\t}\r\n\t\t\t})();\r\n\t\t\t$input.on(\"click\",e=>{\t\t\t\t//显示下拉菜单\r\n\t\t\t\tconst ev=window.event|| e\r\n\t\t\t\tconst flag=this.renderList(this.o.value)\r\n\t\t\t\tif(!flag){\t\t//没有数据\r\n\t\t\t\t\tnode.lists.html(`<li data-disabled=\"true\">${this.o.noData}</li>`)\r\n\t\t\t\t}\r\n\t\t\t\tthis.setPosition()\r\n\t\t\t\tnode.mask.show()\r\n\t\t\t\tnode.drop.show();\r\n\t\t\t\tthis.gotoActive()\r\n\t\t\t\tthis.data.show=true;\t\t\t\r\n\t\t\t\tthis.data.tabIndex=this.data.nowNode.id<0?0:this.data.nowNode.id;\t\t//tabindex默认是0\r\n\r\n\t\t\t\t//重新绑定事件\r\n\t\t\t\tthis.bindMask($input)\r\n\t\t\t\tthis.bindItem()\r\n\r\n\t\t\t\t$(window).on(\"resize\",resizeWindow(this))\r\n\t\t\t\t$(window).on(\"scroll\",this.setPosition.bind(this))\r\n\t\t\t\tev.stopPropagation?ev.stopPropagation():ev.cancelBubble=true;\r\n\t\t\t})\r\n\t\t\tthis.bindKeyDown($input)\r\n\t\t}\r\n\t\tbindItem(){\t\t\t//为列表绑定事件\r\n\t\t\tconst self=this;\r\n\t\t\tnode.lists.on(\"mouseenter\",\"li\",function(){\t\t//鼠标滑过\r\n\t\t\t\t$(this).addClass(\"active\").siblings().removeClass(\"active\")\r\n\t\t\t\tself.data.tabIndex=$(this).data(\"id\")\r\n\t\t\t})\r\n\t\t\tnode.lists.on(\"click\",\"li\",function(e){\t\t\t//点击具体得item\r\n\t\t\t\tvar ev=window.event|| e\r\n\t\t\t\tconst $that=$(this);\t\t\r\n\t\t\t\tif($that.data(\"disabled\")) return false;\t\t//当前不可点击\r\n\t\t\t\tactiveList($that,\"active\",self)\r\n\t\t\t\tself.child.input.val(self.data.nowNode.text)\r\n\t\t\t\tlistHide(self)\r\n\t\t\t\tev.stopPropagation?ev.stopPropagation():ev.cancelBubble=true;\r\n\t\t\t})\r\n\t\t}\r\n\t\tbindMask($input){   //为背景设置点击事件\t\t\t\r\n\t\t\tnode.mask.on('click',()=>{\t\t\t//点击其它地方隐藏下拉框\r\n\t\t\t\tif(this.data.show){\r\n\t\t\t\t\tif(this.data.nowNode.text !== \"\"){\t\t//如果没有选择，则再关闭时回复输入框默认的值\r\n\t\t\t\t\t\t$input.val(this.data.nowNode.text)\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$input.val(this.o.value)\r\n\t\t\t\t\t}\t\t\r\n\t\t\t\t\tlistHide(this)\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tbindKeyDown($input){\t\t//绑定键盘事件\t\r\n\t\t\tconst self=this;\t\r\n\t\t\tthis.child.select.on(\"keydown\",e=>{\t\t\t//上下键\r\n\t\t\t\tconst ev=window.event|| e;\t\t\t\t\r\n\t\t\t\tif(ev.keyCode==38){\t\t\t\t//按↑键\r\n\t\t\t\t\tif(this.data.tabIndex<=0) return false;\r\n\t\t\t\t\t--this.data.tabIndex\r\n\t\t\t\t\tconst currentOffset=node.drop.offset().top,\r\n\t\t\t\t\t\t  $next=node.items.eq(this.data.tabIndex),\r\n\t\t\t\t\t\t  nextTop = $next.offset().top,\r\n\t\t\t\t\t\t  nextOffset = node.drop.scrollTop() + (nextTop - currentOffset);\r\n\t\t\t\t\t$next.addClass(\"active\").siblings().removeClass(\"active\")\r\n\t\t\t\t\tif(nextTop - currentOffset < 0){\r\n\t\t\t\t\t\tnode.drop.scrollTop(nextOffset)\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\tif(ev.keyCode==40){\t\t//按↓键\r\n\t\t\t\t\tif(this.data.tabIndex>=this.data.searchLength-1) return false;\r\n\t\t\t\t\t++this.data.tabIndex;\r\n\t\t\t\t\tconst $next=node.items.eq(this.data.tabIndex),\r\n\t\t\t\t\t\t  currentOffset = node.drop.offset().top + node.drop.outerHeight(false),\r\n\t\t\t\t\t\t  nextBottom = $next.offset().top + $next.outerHeight(false),\r\n\t\t\t\t\t\t  nextOffset = node.drop.scrollTop() + nextBottom - currentOffset;\r\n\t\t\t\t\t$next.addClass(\"active\").siblings().removeClass(\"active\")\r\n\t\t\t\t\tif(nextBottom > currentOffset){\r\n\t\t\t\t\t\tnode.drop.scrollTop(nextOffset)\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\t\t\t\r\n\t\t\t\tif(ev.keyCode==13){\t\t//回车\r\n\t\t\t\t\tlet nowNode=node.items.eq(self.data.tabIndex);\r\n\t\t\t\t\tif(nowNode.data(\"disabled\")) return false;\t\t//当前不可点击\r\n\t\t\t\t\tlistHide(self)\t\r\n\t\t\t\t\tactiveList(nowNode,\"active\",self)\r\n\t\t\t\t\tthis.child.input.val(self.data.nowNode.text)\r\n\t\t\t\t\tconst back=self.getValue();\r\n\t\t\t\t\tself.o.callback && self.o.callback(back.data,back.value)\r\n\t\t\t\t\t$input.blur()\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\tsearch(){\t\t\t//搜索\r\n\t\t\tconst self=this;\r\n\t\t\tthis.child.input.on(\"input propertychange\",function(){\r\n\t\t\t\tif(self.data.listLength<=0){ //没有数据还搜索\r\n\t\t\t\t\tnode.lists.html(`<li data-disabled=\"true\">${this.o.noData}</li>`)\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\tconst val=$.trim(this.value);\r\n\t\t\t\tconst flag=self.renderList(val,true)\r\n\t\t\t\tif(!flag){\t\t//没有搜索到匹配的\r\n\t\t\t\t\tnode.lists.html(`<li data-disabled=\"true\">未找到“${val}”</li>`)\t\t\t\t\t\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(val===\"\"){\t\t//如果输入框是空\r\n\t\t\t\t\t\tself.data.tabIndex=self.data.nowNode.id\r\n\t\t\t\t\t\tself.gotoActive()\r\n\t\t\t\t\t}else{\t\t\t\t//匹配到输入的内容，并让第一个item获得焦点\r\n\t\t\t\t\t\tself.data.tabIndex=0\r\n\t\t\t\t\t\tnode.items.eq(0).addClass(\"active\").siblings().removeClass(\"active\")\r\n\t\t\t\t\t}\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tw.selectPick=selectPick;\r\n})(jQuery, window, document)\r\n"]}
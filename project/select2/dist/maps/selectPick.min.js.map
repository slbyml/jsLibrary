{"version":3,"sources":["selectPick.js"],"names":["$","w","document","undefined","resizeWindow","self","setPosition","activeList","ele","addClass","addName","siblings","removeClass","text","data","nowNode","id","hide","node","mask","listHide","off","show","selectPick","lists","container","window","key","value","listLength","listHeight","placeholder","callback","defaults","search","extend","this","opt","o","dom","searchLength","_createClass","tabIndex","select","getElementById","renderHTML","drop","append","input","find","attr","arguments","length","html","item","m","i","indexOf","searchFlag","items","scrollTop","$active","eq","currentOffset","offset","top","outerHeight","activeBottom","activeOffset","outerWidth","left","css","currentLeft","currentTop","width","_this","$input","on","e","ev","event","renderList","bindMask","bindItem","stopPropagation","cancelBubble","currentWidth","$that","val","_this2","_this3","keyCode","gotoActive","$next","nextTop","nextOffset","nextBottom","back","blur","trim","jQuery"],"mappings":"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","file":"../js/selectPick.min.js","sourcesContent":["/*\r\ncontainer:盛放select得dom\r\nsearch:是否启用模糊搜索\r\ndata:存放数据\r\nkey:有这个说明数组里面是object格式得\r\nlistLength:一屏显示几个list\r\nlistHeight:每个list的高度\r\nplaceholder:提示\r\nvalue:输入框初始值\r\n*/\r\n;(function($, w, document,undefined){\r\n\t//页面大小改变时时更改下拉框得大小和为止\r\n\tconst resizeWindow=(self)=>{\t\t\t\r\n\t\tself.setPosition()\r\n\t}\t\r\n\t//设置选中项\r\n\tconst activeList=(ele,addName,self)=>{\r\n\t\tele.addClass(addName).siblings().removeClass(addName)\r\n\t\tself.data.nowNode={\t\t\t//记录选中的项的数据\r\n\t\t\tid:ele.data(\"id\"),\r\n\t\t\ttext:ele.text()\r\n\t\t}\r\n\t}\t\r\n\t//隐藏下拉框\r\n\tconst listHide=(self)=>{\t\t\t\r\n\t\tself.data.show=false;\t\t\r\n\t\tself.node.drop.hide();\t\r\n\t\tself.node.mask.hide()\r\n\r\n\t\t//防止混乱，每次隐藏下拉时，都注销公用部分事件\r\n\t\tself.node.lists.off(\"click mouseenter\")\t\t\r\n\t\tself.node.mask.off(\"click\")\r\n\r\n\t\t$(window).off(\"resize\",resizeWindow(self))\t\r\n\t}\r\n\tclass selectPick{\r\n\t\tconstructor(opt){\r\n\t\t\tthis.defaults={\r\n\t\t\t\tcontainer:\"body\",\r\n\t\t\t\tsearch:false,\r\n\t\t\t\tdata:[],\r\n\t\t\t\tkey:null,\r\n\t\t\t\tvalue:\"\",\r\n\t\t\t\tlistLength:4,\r\n\t\t\t\tlistHeight:32,\r\n\t\t\t\tplaceholder:\"请输入\",\r\n\t\t\t\tcallback:null\r\n\t\t\t}\r\n\t\t\tthis.o=$.extend(true, this.defaults, opt||{})\r\n\t\t\tthis.dom=$(this.o.container);\r\n\t\t\tthis.data={  //存放插件里面得状态和数据\r\n\t\t\t\tlistLength:0,\t\t//是否有数据\r\n\t\t\t\tsearchLength:0,\t\t//搜索结果的个数\r\n\t\t\t\tshow:false,   //当前下拉是否已经显示\r\n\t\t\t\tchange:false,  //当前数据是否更改过\r\n\t\t\t\ttabIndex:0,  //用来记录按上下键时的id即焦点在第几个li上\r\n\t\t\t\tnowNode:{\t\t//存放已经选中得项\r\n\t\t\t\t\tid:-1,\r\n\t\t\t\t\ttext:\"\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.node={}\t\t//存放插件得dom\t\t\r\n\t\t}\r\n\t\tinit(){\r\n\t\t\tthis.renderHTML()\r\n\t\t\tthis.bind()\r\n\t\t\tif(this.o.search){\t\t//是否有模糊搜索功能\r\n\t\t\t\tthis.search()\r\n\t\t\t}\r\n\t\t}\r\n\t\trenderHTML(){\t\t//渲染页面\r\n\t\t\tthis.node.select=$(` <div class=\"selectPick\" ><input type=\"text\" placeholder=\"${this.o.placeholder}\" value=\"${this.o.value}\"></div>`);\r\n\t\t\t//公共背景\r\n\t\t\tconst mask=document.getElementById(\"selectMask\");\r\n\t\t\tif(!mask){ \r\n\t\t\t\tthis.node.mask=$(\"<div id='selectMask'></div>\")\r\n\t\t\t\t$(\"body\").append(this.node.mask)\r\n\t\t\t}else{\r\n\t\t\t\tthis.node.mask=$(mask)\r\n\t\t\t}\r\n\t\t\t//公共列表\r\n\t\t\tconst drop=document.getElementById(\"selectDrop\");\r\n\t\t\tif(!drop){\t\t\r\n\t\t\t\tthis.node.drop=$(`<div id=\"selectDrop\" style=\"max-height:${this.o.listLength*this.o.listHeight}px\"><ul></ul></div>`)\r\n\t\t\t\t$(\"body\").append(this.node.drop)\r\n\t\t\t}else{\r\n\t\t\t\tthis.node.drop=$(drop)\r\n\t\t\t}\r\n\r\n\t\t\tthis.dom.html(this.node.select);\r\n\t\t\tthis.node.input=this.node.select.find(\"input\");\r\n\t\t\tthis.node.lists=this.node.drop.find(\"ul\");\r\n\t\t\tif(!this.o.search){\t\t//如果没有模糊搜索，则禁用输入框\r\n\t\t\t\tthis.node.input.attr(\"disabled\",\"disabled\")\r\n\t\t\t\tthis.node.select.append(`<div class=\"inputDisabled\"></div>`)\r\n\t\t\t}\t\t\r\n\t\t}\r\n\t\trenderList(text=\"\",searchFlag=false){\t\t//渲染list;text：默认选择和此值匹配得项，searchFlag:区分当前是否是在模糊搜索\r\n\t\t\tlet html=\"\",item=\"\",m=this.data.nowNode.id>=0?this.data.nowNode.id:0;\r\n\t\t\tthis.data.searchLength=0\r\n\t\t\tthis.data.listLength=this.o.data.length\r\n\t\t\tif(this.data.listLength<=0 || this.o.data[0]===\"\") return false;\t\t\t//没有数据\r\n\t\t\tfor(let i=0;i<this.data.listLength;i++){\r\n\t\t\t\titem=this.o.key?this.o.data[i][this.o.key]:this.o.data[i]\r\n\t\t\t\tif(this.o.search && item.indexOf(text)<0 && text != \"\" && searchFlag) continue;\t\t//如果有模糊搜索并且没有匹配到则退出当前循环\r\n\t\t\t\tif(text != \"\" && this.data.nowNode.id<0){\t//如果有初始值,则默认选中初始值\t\r\n\t\t\t\t\tif(item===text){\r\n\t\t\t\t\t\thtml+=`<li data-id=\"${i}\" class=\"active\">${item}</li>`;\r\n\t\t\t\t\t\tthis.data.nowNode={\r\n\t\t\t\t\t\t\tid:i,\r\n\t\t\t\t\t\t\ttext:item\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\thtml+=`<li data-id=\"${i}\">${item}</li>`\r\n\t\t\t\t\t}\t\t\t\t\r\n\t\t\t\t}else{\r\n\t\t\t\t\thtml+=`<li data-id=\"${i}\" ${m===i?`class=\"active\"`:\"\"}>${item}</li>`\r\n\t\t\t\t}\t\t\t\r\n\t\t\t\t++this.data.searchLength\r\n\t\t\t}\r\n\t\t\tif(this.o.search && html===\"\") return false;  //搜索时没有匹配到\r\n\t\t\tthis.node.lists.html(html)\r\n\t\t\tthis.node.items=this.node.lists.find(\"li\");\t\t//选择已经渲染到页面得数据node\r\n\t\t\treturn true\r\n\t\t}\r\n\t\tsetData(data=[]){\t\t\t//设置下拉列表得数据\r\n\t\t\tthis.o.data=data;\r\n\t\t\tif(this.o.value === \"\"){\r\n\t\t\t\tthis.node.input.val(\"\");\t\t\t\r\n\t\t\t}\r\n\t\t\tthis.data={\r\n\t\t\t\tshow:false,\r\n\t\t\t\tnowNode:{\r\n\t\t\t\t\tid:-1,\r\n\t\t\t\t\ttext:\"\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.data.show=false;\r\n\t\t\tthis.node.drop.hide();\t\r\n\t\t\tthis.node.mask.hide()\r\n\t\t}\r\n\t\tgetValue(){\r\n\t\t\treturn {\r\n\t\t\t\tdata:this.data.nowNode.id<0?-1:this.o.data[this.data.nowNode.id],\r\n\t\t\t\tvalue:this.data.nowNode.text\r\n\t\t\t}\t\t\t\t//获取已经选中得项得数据\r\n\t\t}\r\n\t\tgotoActive(){\t\t\t//设置已经选中项在页面可视区域\r\n\t\t\tif(this.data.nowNode.id === -1){\t\t//如果没有选中项，\r\n\t\t\t\tthis.node.drop.scrollTop(0)\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\tconst $active=this.node.items.eq(this.data.nowNode.id),\r\n\t\t\t\t  currentOffset=this.node.drop.offset().top + this.node.drop.outerHeight(false),\r\n\t\t\t\t  activeBottom = $active.offset().top + $active.outerHeight(false),\r\n\t\t\t\t  activeOffset = this.node.drop.scrollTop() + activeBottom - currentOffset;\r\n\t\t\tthis.node.drop.scrollTop(activeOffset)\r\n\t\t}\r\n\t\tsetPosition(){\t\t//设置下拉框得位置和大小\r\n\t\t\tconst currentOffset=this.node.select.offset(),\r\n\t\t\t      currentTop=currentOffset.top+this.node.select.outerHeight(false),\r\n\t\t\t      currentWidth=this.node.select.outerWidth(),\r\n\t\t\t      currentLeft=currentOffset.left;\r\n\t\t\tthis.node.drop.css({\r\n\t\t\t\tleft:currentLeft,\r\n\t\t\t\ttop:currentTop,\r\n\t\t\t\twidth:currentWidth-2\r\n\t\t\t})\r\n\t\t}\r\n\t\tbind(){\t\t//绑定事件\r\n\t\t\tconst self=this;\r\n\t\t\tconst $input=(()=>{\t\t\t//选择接受点击事件得元素\r\n\t\t\t\tif(!this.o.search){\r\n\t\t\t\t\treturn this.node.select.find(\".inputDisabled\")\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn this.node.input\r\n\t\t\t\t}\r\n\t\t\t})();\r\n\t\t\t$input.on(\"click\",e=>{\t\t\t\t//显示下拉菜单\r\n\t\t\t\tconst ev=window.event|| e\r\n\t\t\t\tconst flag=this.renderList(this.o.value)\r\n\t\t\t\tif(!flag){\t\t//没有数据\r\n\t\t\t\t\tself.node.lists.html(`<li data-disabled=\"true\">没有数据</li>`)\r\n\t\t\t\t}\r\n\t\t\t\tthis.setPosition()\r\n\t\t\t\tthis.node.mask.show()\r\n\t\t\t\tthis.node.drop.show();\r\n\t\t\t\tthis.gotoActive()\r\n\t\t\t\tthis.data.show=true;\t\t\t\r\n\t\t\t\tthis.data.tabIndex=this.data.nowNode.id<0?0:this.data.nowNode.id;\t\t//tabindex默认是0\r\n\r\n\t\t\t\t//重新绑定事件\r\n\t\t\t\tthis.bindMask($input)\r\n\t\t\t\tthis.bindItem()\r\n\r\n\t\t\t\t$(window).on(\"resize\",resizeWindow(this))\r\n\t\t\t\tev.stopPropagation?ev.stopPropagation():ev.cancelBubble=true;\r\n\t\t\t})\r\n\t\t\tthis.bindKeyDown($input)\r\n\t\t}\r\n\t\tbindItem(){\t\t\t//为列表绑定事件\r\n\t\t\tconst self=this;\r\n\t\t\tthis.node.lists.on(\"mouseenter\",\"li\",function(){\t\t//鼠标滑过\r\n\t\t\t\t$(this).addClass(\"active\").siblings().removeClass(\"active\")\r\n\t\t\t\tself.data.tabIndex=$(this).data(\"id\")\r\n\t\t\t})\r\n\t\t\tthis.node.lists.on(\"click\",\"li\",function(e){\t\t\t//点击具体得item\r\n\t\t\t\tvar ev=window.event|| e\r\n\t\t\t\tconst $that=$(this);\t\t\r\n\t\t\t\tif($that.data(\"disabled\")) return false;\t\t//当前不可点击\r\n\t\t\t\tactiveList($that,\"active\",self)\r\n\t\t\t\tself.node.input.val(self.data.nowNode.text)\r\n\t\t\t\tlistHide(self)\r\n\t\t\t\tev.stopPropagation?ev.stopPropagation():ev.cancelBubble=true;\r\n\t\t\t})\r\n\t\t}\r\n\t\tbindMask($input){   //为背景设置点击事件\t\t\t\r\n\t\t\tthis.node.mask.on('click',()=>{\t\t\t//点击其它地方隐藏下拉框\r\n\t\t\t\tif(this.data.show){\r\n\t\t\t\t\tif(this.data.nowNode.text !== \"\"){\t\t//如果没有选择，则再关闭时回复输入框默认的值\r\n\t\t\t\t\t\t$input.val(this.data.nowNode.text)\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$input.val(\"\")\r\n\t\t\t\t\t}\t\t\r\n\t\t\t\t\tlistHide(this)\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tbindKeyDown($input){\t\t//绑定键盘事件\t\r\n\t\t\tconst self=this;\t\r\n\t\t\tthis.node.select.on(\"keydown\",e=>{\t\t\t//上下键\r\n\t\t\t\tconst ev=window.event|| e;\t\t\t\t\r\n\t\t\t\tif(ev.keyCode==38){\t\t\t\t//按↑键\r\n\t\t\t\t\tif(this.data.tabIndex<=0) return false;\r\n\t\t\t\t\t--this.data.tabIndex\r\n\t\t\t\t\tconst currentOffset=this.node.drop.offset().top,\r\n\t\t\t\t\t\t  $next=this.node.items.eq(this.data.tabIndex),\r\n\t\t\t\t\t\t  nextTop = $next.offset().top,\r\n\t\t\t\t\t\t  nextOffset = this.node.drop.scrollTop() + (nextTop - currentOffset);\r\n\t\t\t\t\t$next.addClass(\"active\").siblings().removeClass(\"active\")\r\n\t\t\t\t\tif(nextTop - currentOffset < 0){\r\n\t\t\t\t\t\tthis.node.drop.scrollTop(nextOffset)\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\tif(ev.keyCode==40){\t\t//按↓键\r\n\t\t\t\t\tif(this.data.tabIndex>=this.data.searchLength-1) return false;\r\n\t\t\t\t\t++this.data.tabIndex;\r\n\t\t\t\t\tconst $next=this.node.items.eq(this.data.tabIndex),\r\n\t\t\t\t\t\t  currentOffset = this.node.drop.offset().top + this.node.drop.outerHeight(false),\r\n\t\t\t\t\t\t  nextBottom = $next.offset().top + $next.outerHeight(false),\r\n\t\t\t\t\t\t  nextOffset = this.node.drop.scrollTop() + nextBottom - currentOffset;\r\n\t\t\t\t\t$next.addClass(\"active\").siblings().removeClass(\"active\")\r\n\t\t\t\t\tif(nextBottom > currentOffset){\r\n\t\t\t\t\t\tthis.node.drop.scrollTop(nextOffset)\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\t\t\t\r\n\t\t\t\tif(ev.keyCode==13){\t\t//回车\r\n\t\t\t\t\tlet nowNode=self.node.items.eq(self.data.tabIndex);\r\n\t\t\t\t\tif(nowNode.data(\"disabled\")) return false;\t\t//当前不可点击\r\n\t\t\t\t\tlistHide(self)\t\r\n\t\t\t\t\tactiveList(nowNode,\"active\",self)\r\n\t\t\t\t\tself.node.input.val(self.data.nowNode.text)\r\n\t\t\t\t\tconst back=self.getValue();\r\n\t\t\t\t\tself.o.callback && self.o.callback(back.data,back.value)\r\n\t\t\t\t\t$input.blur()\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\tsearch(){\t\t\t//搜索\r\n\t\t\tconst self=this;\r\n\t\t\tthis.node.input.on(\"input propertychange\",function(){\r\n\t\t\t\tif(self.data.listLength<=0){ //没有数据还搜索\r\n\t\t\t\t\tself.node.lists.html(`<li data-disabled=\"true\">没有数据</li>`)\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\tconst val=$.trim(this.value);\r\n\t\t\t\tconst flag=self.renderList(val,true)\r\n\t\t\t\tif(!flag){\t\t//没有搜索到匹配的\r\n\t\t\t\t\tself.node.lists.html(`<li data-disabled=\"true\">未找到“${val}”</li>`)\t\t\t\t\t\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(val===\"\"){\t\t//如果输入框是空\r\n\t\t\t\t\t\tself.data.tabIndex=self.data.nowNode.id\r\n\t\t\t\t\t\tself.gotoActive()\r\n\t\t\t\t\t}else{\t\t\t\t//匹配到输入的内容，并让第一个item获得焦点\r\n\t\t\t\t\t\tself.data.tabIndex=0\r\n\t\t\t\t\t\tself.node.items.eq(0).addClass(\"active\").siblings().removeClass(\"active\")\r\n\t\t\t\t\t}\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tw.selectPick=selectPick;\r\n})(jQuery, window, document)\r\n"]}
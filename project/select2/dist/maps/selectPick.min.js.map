{"version":3,"sources":["selectPick.js"],"names":["$","w","document","undefined","resizeWindow","self","setPosition","activeList","ele","addClass","addName","siblings","removeClass","text","data","nowNode","id","hide","node","mask","listHide","off","show","search","key","value","listLength","defaults","container","listHeight","opt","_classCallCheck","this","selectPick","placeholder","callback","o","noData","searchLength","change","tabIndex","dom","_createClass","select","getElementById","renderHTML","drop","append","input","find","attr","arguments","length","html","item","m","i","indexOf","searchFlag","lists","items","val","l","scrollTop","eq","currentOffset","offset","top","outerHeight","activeBottom","$active","activeOffset","currentLeft","left","css","currentTop","width","currentWidth","_this","$input","on","e","ev","window","event","renderList","gotoActive","stopPropagation","cancelBubble","bindKeyDown","$that","_this2","_this3","flag","keyCode","$next","nextTop","nextOffset","bindMask","nextBottom","getValue","back","trim","jQuery"],"mappings":"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","file":"../js/selectPick.min.js","sourcesContent":["/*\r\ncontainer:盛放select得dom\r\nsearch:是否启用模糊搜索\r\ndata:存放数据\r\nkey:有这个说明数组里面是object格式得\r\nlistLength:一屏显示几个list\r\nlistHeight:每个list的高度\r\nplaceholder:提示\r\nvalue:输入框初始值\r\nnoData:没有数据时得显示\r\n*/\r\n;(function($, w, document,undefined){\r\n\t//页面大小改变时时更改下拉框得大小和为止\r\n\tconst resizeWindow=(self)=>{\t\t\t\r\n\t\tself.setPosition()\r\n\t}\t\r\n\t//设置选中项\r\n\tconst activeList=(ele,addName,self)=>{\r\n\t\tele.addClass(addName).siblings().removeClass(addName)\r\n\t\tself.data.nowNode={\t\t\t//记录选中的项的数据\r\n\t\t\tid:ele.data(\"id\"),\r\n\t\t\ttext:ele.text()\r\n\t\t}\r\n\t}\t\r\n\t//隐藏下拉框\r\n\tconst listHide=(self)=>{\t\t\t\r\n\t\tself.data.show=false;\t\t\r\n\t\tself.node.drop.hide();\t\r\n\t\tself.node.mask.hide()\r\n\r\n\t\t//防止混乱和多次绑定事件，每次隐藏下拉时，都注销公用部分事件\r\n\t\tself.node.lists.off(\"click mouseenter\")\t\t\r\n\t\tself.node.mask.off(\"click\")\r\n\r\n\t\t$(window).off(\"resize\",resizeWindow(self))\t\r\n\t}\r\n\t/*默认值*/\r\n\tconst defaults={\r\n\t\tcontainer:\"body\",\r\n\t\tsearch:false,\r\n\t\tdata:[],\r\n\t\tkey:null,\r\n\t\tvalue:\"\",\r\n\t\tlistLength:4,\r\n\t\tlistHeight:32,\r\n\t\tplaceholder:\"请输入\",\r\n\t\tcallback:null,\r\n\t\tnoData:\"没有数据\"\t\t\r\n\t}\r\n\tclass selectPick{\r\n\t\tconstructor(opt){\r\n\t\t\tthis.o=$.extend(true,{},defaults, opt||{})\r\n\t\t\tthis.dom=$(this.o.container);\r\n\t\t\tthis.data={  //存放插件里面得状态和数据\r\n\t\t\t\tlistLength:0,\t\t//是否有数据\r\n\t\t\t\tsearchLength:0,\t\t//搜索结果的个数\r\n\t\t\t\tshow:false,   //当前下拉是否已经显示\r\n\t\t\t\tchange:false,  //当前数据是否更改过\r\n\t\t\t\ttabIndex:0,  //用来记录按上下键时的id即焦点在第几个li上\r\n\t\t\t\tnowNode:{\t\t//存放已经选中得项\r\n\t\t\t\t\tid:-1,\r\n\t\t\t\t\ttext:\"\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.node={}\t\t//存放插件得dom\t\t\r\n\t\t}\r\n\t\tinit(){\r\n\t\t\tthis.renderHTML()\r\n\t\t\tthis.bind()\r\n\t\t\tif(this.o.search){\t\t//是否有模糊搜索功能\r\n\t\t\t\tthis.search()\r\n\t\t\t}\r\n\t\t}\r\n\t\trenderHTML(){\t\t//渲染页面\r\n\t\t\tthis.node.select=$(` <div class=\"selectPick\" ><input type=\"text\" placeholder=\"${this.o.placeholder}\" value=\"${this.o.value}\"></div>`);\r\n\t\t\t//公共背景\r\n\t\t\tconst mask=document.getElementById(\"selectMask\");\r\n\t\t\tif(!mask){ \r\n\t\t\t\tthis.node.mask=$(\"<div id='selectMask'></div>\")\r\n\t\t\t\t$(\"body\").append(this.node.mask)\r\n\t\t\t}else{\r\n\t\t\t\tthis.node.mask=$(mask)\r\n\t\t\t}\r\n\t\t\t//公共列表\r\n\t\t\tconst drop=document.getElementById(\"selectDrop\");\r\n\t\t\tif(!drop){\t\t\r\n\t\t\t\tthis.node.drop=$(`<div id=\"selectDrop\" style=\"max-height:${this.o.listLength*this.o.listHeight}px\"><ul></ul></div>`)\r\n\t\t\t\t$(\"body\").append(this.node.drop)\r\n\t\t\t}else{\r\n\t\t\t\tthis.node.drop=$(drop)\r\n\t\t\t}\r\n\r\n\t\t\tthis.dom.html(this.node.select);\r\n\t\t\tthis.node.input=this.node.select.find(\"input\");\r\n\t\t\tthis.node.lists=this.node.drop.find(\"ul\");\r\n\t\t\tif(!this.o.search){\t\t//如果没有模糊搜索，则禁用输入框\r\n\t\t\t\tthis.node.input.attr(\"disabled\",\"disabled\")\r\n\t\t\t\tthis.node.select.append(`<div class=\"inputDisabled\"></div>`)\r\n\t\t\t}\t\t\r\n\t\t}\r\n\t\trenderList(text=\"\",searchFlag=false){\t\t//渲染list;text：默认选择和此值匹配得项，searchFlag:区分当前是否是在模糊搜索\r\n\t\t\tlet html=\"\",item=\"\",m=this.data.nowNode.id>=0?this.data.nowNode.id:0;\r\n\t\t\tthis.data.searchLength=0\r\n\t\t\tthis.data.listLength=this.o.data.length\r\n\t\t\tif(this.data.listLength<=0 || this.o.data[0]===\"\") return false;\t\t\t//没有数据\r\n\t\t\tfor(let i=0;i<this.data.listLength;i++){\r\n\t\t\t\titem=this.o.key?this.o.data[i][this.o.key]:this.o.data[i]\r\n\t\t\t\tif(this.o.search && item.indexOf(text)<0 && text != \"\" && searchFlag) continue;\t\t//如果有模糊搜索并且没有匹配到则退出当前循环\r\n\t\t\t\tif(text != \"\" && this.data.nowNode.id<0){\t//如果有初始值,则默认选中初始值\t\r\n\t\t\t\t\tif(item===text){\r\n\t\t\t\t\t\thtml+=`<li data-id=\"${i}\" class=\"active\">${item}</li>`;\r\n\t\t\t\t\t\tthis.data.nowNode={\r\n\t\t\t\t\t\t\tid:i,\r\n\t\t\t\t\t\t\ttext:item\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.data.tabIndex=i\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\thtml+=`<li data-id=\"${i}\">${item}</li>`\r\n\t\t\t\t\t}\t\t\t\t\r\n\t\t\t\t}else{\r\n\t\t\t\t\thtml+=`<li data-id=\"${i}\" ${m===i?`class=\"active\"`:\"\"}>${item}</li>`\r\n\t\t\t\t}\t\t\t\r\n\t\t\t\t++this.data.searchLength\r\n\t\t\t}\r\n\t\t\tif(this.o.search && html===\"\") return false;  //搜索时没有匹配到\r\n\t\t\tthis.node.lists.html(html)\r\n\t\t\tthis.node.items=this.node.lists.find(\"li\");\t\t//选择已经渲染到页面得数据node\r\n\t\t\treturn true\r\n\t\t}\r\n\t\tsetData(data=[]){\t\t\t//设置下拉列表得数据\r\n\t\t\tthis.o.data=data;\r\n\t\t\tif(this.o.value === \"\"){\r\n\t\t\t\tthis.node.input.val(\"\");\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\tthis.node.input.val(this.o.value)\r\n\t\t\t}\r\n\t\t\tthis.data={\r\n\t\t\t\tshow:false,\r\n\t\t\t\tnowNode:{\r\n\t\t\t\t\tid:-1,\r\n\t\t\t\t\ttext:\"\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.data.show=false;\r\n\t\t\tthis.node.drop.hide();\t\r\n\t\t\tthis.node.mask.hide()\r\n\t\t\treturn this\r\n\t\t}\r\n\t\tgetValue(){\t\t\t//获取已经选中得项得数据\r\n\t\t\treturn {\r\n\t\t\t\tdata:this.data.nowNode.id<0?-1:this.o.data[this.data.nowNode.id],\r\n\t\t\t\tvalue:this.data.nowNode.text\r\n\t\t\t}\t\t\t\t\r\n\t\t}\r\n\t\tsetDefaultVal(val=\"\"){\t\t//设置默认值，为异步设置默认值用得\r\n\t\t\tthis.o.value=val\r\n\t\t\tthis.node.input.val(val)\r\n\t\t\tlet item=\"\";\r\n\t\t\tfor(let i=0,l=this.o.data.length;i<l;i++){\r\n\t\t\t\titem=this.o.key?this.o.data[i][this.o.key]:this.o.data[i];\r\n\t\t\t\tif(item===val){\t\t\t\t\t\r\n\t\t\t\t\tthis.data.nowNode={\r\n\t\t\t\t\t\tid:i,\r\n\t\t\t\t\t\ttext:item\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tgotoActive(){\t\t\t//设置已经选中项在页面可视区域\r\n\t\t\tif(this.data.nowNode.id === -1){\t\t//如果没有选中项，\r\n\t\t\t\tthis.node.drop.scrollTop(0)\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\tconst $active=this.node.items.eq(this.data.nowNode.id),\r\n\t\t\t\t  currentOffset=this.node.drop.offset().top + this.node.drop.outerHeight(false),\r\n\t\t\t\t  activeBottom = $active.offset().top + $active.outerHeight(false),\r\n\t\t\t\t  activeOffset = this.node.drop.scrollTop() + activeBottom - currentOffset;\r\n\t\t\tthis.node.drop.scrollTop(activeOffset)\r\n\t\t}\r\n\t\tsetPosition(){\t\t//设置下拉框得位置和大小\r\n\t\t\tconst currentOffset=this.node.select.offset(),\r\n\t\t\t      currentTop=currentOffset.top+this.node.select.outerHeight(false),\r\n\t\t\t      currentWidth=this.node.select.outerWidth(),\r\n\t\t\t      currentLeft=currentOffset.left;\r\n\t\t\tthis.node.drop.css({\r\n\t\t\t\tleft:currentLeft,\r\n\t\t\t\ttop:currentTop,\r\n\t\t\t\twidth:currentWidth-2\r\n\t\t\t})\r\n\t\t}\r\n\t\tbind(){\t\t//绑定事件\r\n\t\t\tconst self=this;\r\n\t\t\tconst $input=(()=>{\t\t\t//选择接受点击事件得元素\r\n\t\t\t\tif(!this.o.search){\r\n\t\t\t\t\treturn this.node.select.find(\".inputDisabled\")\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn this.node.input\r\n\t\t\t\t}\r\n\t\t\t})();\r\n\t\t\t$input.on(\"click\",e=>{\t\t\t\t//显示下拉菜单\r\n\t\t\t\tconst ev=window.event|| e\r\n\t\t\t\tconst flag=this.renderList(this.o.value)\r\n\t\t\t\tif(!flag){\t\t//没有数据\r\n\t\t\t\t\tself.node.lists.html(`<li data-disabled=\"true\">${this.o.noData}</li>`)\r\n\t\t\t\t}\r\n\t\t\t\tthis.setPosition()\r\n\t\t\t\tthis.node.mask.show()\r\n\t\t\t\tthis.node.drop.show();\r\n\t\t\t\tthis.gotoActive()\r\n\t\t\t\tthis.data.show=true;\t\t\t\r\n\t\t\t\tthis.data.tabIndex=this.data.nowNode.id<0?0:this.data.nowNode.id;\t\t//tabindex默认是0\r\n\r\n\t\t\t\t//重新绑定事件\r\n\t\t\t\tthis.bindMask($input)\r\n\t\t\t\tthis.bindItem()\r\n\r\n\t\t\t\t$(window).on(\"resize\",resizeWindow(this))\r\n\t\t\t\tev.stopPropagation?ev.stopPropagation():ev.cancelBubble=true;\r\n\t\t\t})\r\n\t\t\tthis.bindKeyDown($input)\r\n\t\t}\r\n\t\tbindItem(){\t\t\t//为列表绑定事件\r\n\t\t\tconst self=this;\r\n\t\t\tthis.node.lists.on(\"mouseenter\",\"li\",function(){\t\t//鼠标滑过\r\n\t\t\t\t$(this).addClass(\"active\").siblings().removeClass(\"active\")\r\n\t\t\t\tself.data.tabIndex=$(this).data(\"id\")\r\n\t\t\t})\r\n\t\t\tthis.node.lists.on(\"click\",\"li\",function(e){\t\t\t//点击具体得item\r\n\t\t\t\tvar ev=window.event|| e\r\n\t\t\t\tconst $that=$(this);\t\t\r\n\t\t\t\tif($that.data(\"disabled\")) return false;\t\t//当前不可点击\r\n\t\t\t\tactiveList($that,\"active\",self)\r\n\t\t\t\tself.node.input.val(self.data.nowNode.text)\r\n\t\t\t\tlistHide(self)\r\n\t\t\t\tev.stopPropagation?ev.stopPropagation():ev.cancelBubble=true;\r\n\t\t\t})\r\n\t\t}\r\n\t\tbindMask($input){   //为背景设置点击事件\t\t\t\r\n\t\t\tthis.node.mask.on('click',()=>{\t\t\t//点击其它地方隐藏下拉框\r\n\t\t\t\tif(this.data.show){\r\n\t\t\t\t\tif(this.data.nowNode.text !== \"\"){\t\t//如果没有选择，则再关闭时回复输入框默认的值\r\n\t\t\t\t\t\t$input.val(this.data.nowNode.text)\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$input.val(this.o.value)\r\n\t\t\t\t\t}\t\t\r\n\t\t\t\t\tlistHide(this)\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tbindKeyDown($input){\t\t//绑定键盘事件\t\r\n\t\t\tconst self=this;\t\r\n\t\t\tthis.node.select.on(\"keydown\",e=>{\t\t\t//上下键\r\n\t\t\t\tconst ev=window.event|| e;\t\t\t\t\r\n\t\t\t\tif(ev.keyCode==38){\t\t\t\t//按↑键\r\n\t\t\t\t\tif(this.data.tabIndex<=0) return false;\r\n\t\t\t\t\t--this.data.tabIndex\r\n\t\t\t\t\tconst currentOffset=this.node.drop.offset().top,\r\n\t\t\t\t\t\t  $next=this.node.items.eq(this.data.tabIndex),\r\n\t\t\t\t\t\t  nextTop = $next.offset().top,\r\n\t\t\t\t\t\t  nextOffset = this.node.drop.scrollTop() + (nextTop - currentOffset);\r\n\t\t\t\t\t$next.addClass(\"active\").siblings().removeClass(\"active\")\r\n\t\t\t\t\tif(nextTop - currentOffset < 0){\r\n\t\t\t\t\t\tthis.node.drop.scrollTop(nextOffset)\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\tif(ev.keyCode==40){\t\t//按↓键\r\n\t\t\t\t\tif(this.data.tabIndex>=this.data.searchLength-1) return false;\r\n\t\t\t\t\t++this.data.tabIndex;\r\n\t\t\t\t\tconst $next=this.node.items.eq(this.data.tabIndex),\r\n\t\t\t\t\t\t  currentOffset = this.node.drop.offset().top + this.node.drop.outerHeight(false),\r\n\t\t\t\t\t\t  nextBottom = $next.offset().top + $next.outerHeight(false),\r\n\t\t\t\t\t\t  nextOffset = this.node.drop.scrollTop() + nextBottom - currentOffset;\r\n\t\t\t\t\t$next.addClass(\"active\").siblings().removeClass(\"active\")\r\n\t\t\t\t\tif(nextBottom > currentOffset){\r\n\t\t\t\t\t\tthis.node.drop.scrollTop(nextOffset)\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\t\t\t\r\n\t\t\t\tif(ev.keyCode==13){\t\t//回车\r\n\t\t\t\t\tlet nowNode=self.node.items.eq(self.data.tabIndex);\r\n\t\t\t\t\tif(nowNode.data(\"disabled\")) return false;\t\t//当前不可点击\r\n\t\t\t\t\tlistHide(self)\t\r\n\t\t\t\t\tactiveList(nowNode,\"active\",self)\r\n\t\t\t\t\tself.node.input.val(self.data.nowNode.text)\r\n\t\t\t\t\tconst back=self.getValue();\r\n\t\t\t\t\tself.o.callback && self.o.callback(back.data,back.value)\r\n\t\t\t\t\t$input.blur()\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\tsearch(){\t\t\t//搜索\r\n\t\t\tconst self=this;\r\n\t\t\tthis.node.input.on(\"input propertychange\",function(){\r\n\t\t\t\tif(self.data.listLength<=0){ //没有数据还搜索\r\n\t\t\t\t\tself.node.lists.html(`<li data-disabled=\"true\">${this.o.noData}</li>`)\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\tconst val=$.trim(this.value);\r\n\t\t\t\tconst flag=self.renderList(val,true)\r\n\t\t\t\tif(!flag){\t\t//没有搜索到匹配的\r\n\t\t\t\t\tself.node.lists.html(`<li data-disabled=\"true\">未找到“${val}”</li>`)\t\t\t\t\t\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(val===\"\"){\t\t//如果输入框是空\r\n\t\t\t\t\t\tself.data.tabIndex=self.data.nowNode.id\r\n\t\t\t\t\t\tself.gotoActive()\r\n\t\t\t\t\t}else{\t\t\t\t//匹配到输入的内容，并让第一个item获得焦点\r\n\t\t\t\t\t\tself.data.tabIndex=0\r\n\t\t\t\t\t\tself.node.items.eq(0).addClass(\"active\").siblings().removeClass(\"active\")\r\n\t\t\t\t\t}\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tw.selectPick=selectPick;\r\n})(jQuery, window, document)\r\n"]}